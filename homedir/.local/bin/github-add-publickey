#!/usr/bin/env bash

set -x

local date="$(date +"%Y%m%d-%H%M%S")"
local hostname=`hostname`
echo "enter username: "; read username
echo "enter password: "; read password
echo "enter otp: ";	  read otp
local sshPublicKeyData="$(cat $HOME/.ssh/id_rsa.pub)"
curl \
    -u "$username:$password" \
    -H "X-GitHub-OTP: $otp" \
    --data "{\"title\": \"$hostname - $date\",\"key\":\"$sshPublicKeyData\"}" \
    https://api.github.com/user/keys
